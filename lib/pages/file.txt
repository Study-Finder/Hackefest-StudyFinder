import 'package:flutter/material.dart';
import 'package:file_picker/file_picker.dart';

class UploadFilePage extends StatefulWidget {
  @override
  _UploadFilePageState createState() => _UploadFilePageState();
}

class _UploadFilePageState extends State<UploadFilePage> {
  String _fileName = '';

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('Upload File PDF'),
      ),
      body: Padding(
        padding: const EdgeInsets.all(16.0),
        child: Center(
          child: InkWell(
            onTap: _openFileExplorer,
            child: Container(
              width: double.infinity,
              height: 200, // Contoh ukuran yang lebih besar
              decoration: BoxDecoration(
                border: Border.all(
                  color: Colors.grey, // Warna outline
                  width: 2.0, // Ketebalan outline
                ),
                borderRadius: BorderRadius.circular(8.0),
              ),
              child: Center(
                child: ListTile(
                  leading: _fileName.isNotEmpty
                      ? Icon(Icons.file_present, size: 40)
                      : Icon(Icons.add, size: 40),
                  title: Text(
                    'File PDF Terpilih:',
                    style: TextStyle(fontWeight: FontWeight.bold, fontSize: 18),
                  ),
                  subtitle: Text(
                    _fileName.isEmpty ? 'Ketuk untuk memilih file' : _fileName,
                    style: TextStyle(fontSize: 16),
                  ),
                  trailing: _fileName.isNotEmpty
                      ? IconButton(
                          icon: Icon(Icons.clear, size: 30),
                          onPressed: () {
                            _clearSelectedFile();
                          },
                        )
                      : null,
                ),
              ),
            ),
          ),
        ),
      ),
      SizedBox(height: 16.0),
      ElevatedButton(
              onPressed: () {
                if (_fileName.isNotEmpty) {
                  _uploadFile();
                } else {
                  _showSnackbar('Pilih file PDF terlebih dahulu',
                      isError: true);
                }
              },
              child: Text('Unggah File'),
      ),
    );
  }

  Future<void> _openFileExplorer() async {
    try {
      FilePickerResult? result = await FilePicker.platform.pickFiles(
        type: FileType.custom,
        allowedExtensions: ['pdf'],
      );

      if (result != null) {
        String fileName = result.files.single.name;
        setState(() {
          _fileName = fileName;
        });
      }
    } on Exception catch (e) {
      print('Error: $e');
    }
  }

  void _clearSelectedFile() {
    setState(() {
      _fileName = '';
    });
  }

  void _showSnackbar(String message, {bool isError = false}) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(message),
        backgroundColor: isError ? Colors.red : Colors.green,
      ),
    );
  }

  void _uploadFile() {
    // Tambahkan logika untuk mengunggah file PDF ke server atau melakukan tindakan lainnya di sini
    if (_fileName.isNotEmpty) {
      _showSnackbar('File PDF berhasil diunggah');
      print('File PDF diunggah: $_fileName');
    } else {
      _showSnackbar('Pilih file PDF terlebih dahulu', isError: true);
    }
  }
}
